<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Library - BlinkNotes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="mesh-bg"></div>
    <div class="bg-accent-blob"></div>

    <!-- NAVBAR -->
    <nav>
        <div class="brand">
            <a href="index.html"><i class="fas fa-book-open"></i> <span>BlinkNotes</span></a>
        </div>
        <ul class="nav-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="browse.html" class="active">Browse</a></li>
            <li><a href="upload.html">Upload</a></li>
            <li><a href="chat.html">AI Assistant</a></li>
            <li><a href="login.html" class="btn btn-accent btn-sm">Sign In</a></li>
        </ul>
    </nav>

    <!-- BROWSE HEADER -->
    <header class="hero-section container animate-fade-in" style="padding: 4rem 0 2rem;">
        <h1 class="hero-title" style="font-size: 3rem;">Browse <span style="color: var(--accent);">Academic
                Library</span></h1>
        <p class="hero-description">Discover the best study materials shared by your community.</p>

        <!-- SEARCH & FILTERS -->
        <div class="animate-fade-in"
            style="max-width: 800px; margin: 0 auto; background: var(--bg-glass); padding: 1.5rem; border-radius: var(--radius-xl); border: 1px solid var(--border); box-shadow: var(--shadow-xl);">
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                <div style="flex: 1; position: relative;">
                    <i class="fas fa-search"
                        style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                    <input type="text" id="searchInput" class="form-control"
                        placeholder="Search by title, subject, or tags..." style="padding-left: 2.8rem;">
                </div>
                <button class="btn btn-primary" onclick="filterNotes()">Search</button>
            </div>

            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <select id="subjectFilter" class="form-control" style="flex: 1; min-width: 150px;">
                    <option value="">All Subjects</option>
                    <option value="mathematics">Mathematics</option>
                    <option value="physics">Physics</option>
                    <option value="chemistry">Chemistry</option>
                    <option value="biology">Biology</option>
                    <option value="computerscience">Computer Science</option>
                </select>

                <select id="sortFilter" class="form-control" style="flex: 1; min-width: 150px;">
                    <option value="latest">Sort by Latest</option>
                    <option value="popular">Most Popular</option>
                    <option value="rating">Top Rated</option>
                </select>
            </div>
        </div>
    </header>

    <!-- NOTES GRID -->
    <main class="container" style="margin-bottom: 6rem;">
        <div id="notesGrid" class="grid grid-3">
            <!-- Loading State -->
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                <div class="spinner" style="margin: 0 auto 1.5rem;"></div>
                <p style="color: var(--text-muted);">Curating the best notes for you...</p>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-bottom" style="border-top: none;">
                &copy; 2025 BlinkNotes. Empowering students everywhere.
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script>
        async function loadNotes() {
            const notesGrid = document.getElementById('notesGrid');
            const searchInput = document.getElementById('searchInput').value;
            const subjectFilter = document.getElementById('subjectFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;

            // Build query parameters
            const params = new URLSearchParams();
            if (searchInput) params.append('q', searchInput);
            if (subjectFilter) params.append('subject', subjectFilter);
            if (sortFilter) {
                if (sortFilter === 'latest') params.append('sort', 'newest');
                else if (sortFilter === 'popular') params.append('sort', 'most_downloads');
            }

            try {
                const response = await fetch(`${window.env.API_URL}/files?${params.toString()}`);
                const data = await response.json();

                if (response.ok && Array.isArray(data) && data.length > 0) {
                    notesGrid.innerHTML = data.map(note => `
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                                <span class="badge badge-primary">${note.subject || 'Note'}</span>
                                <div style="color: var(--accent); font-weight: 700; font-size: 0.875rem;">
                                    <i class="fas fa-download"></i> ${note.downloads || 0}
                                </div>
                            </div>
                            <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem; font-family: 'Outfit';">${note.title}</h3>
                            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.25rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${note.description || 'No description provided.'}
                            </p>
                            <div style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 1.5rem;">
                                <i class="fas fa-user-circle" style="font-size: 1.2rem;"></i>
                                <span>${note.uploader || 'Anonymous'} â€¢ ${new Date(note.uploadDate).toLocaleDateString()}</span>
                            </div>
                            <div style="display: flex; gap: 0.75rem;">
                                <a href="${window.env.API_URL}/download/${note.id}" class="btn btn-primary" style="flex: 1;" target="_blank">
                                    <i class="fas fa-download"></i> Download
                                </a>
                                <button class="btn btn-outline" style="padding: 0.75rem;">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    notesGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                            <i class="fas fa-search" style="font-size: 4rem; color: var(--border); margin-bottom: 1.5rem;"></i>
                            <h3>No results matched your search</h3>
                            <p style="color: var(--text-muted);">Try different keywords or filters.</p>
                            <button class="btn btn-outline" style="margin-top: 1.5rem;" onclick="resetFilters()">Clear Filters</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading notes:', error);
                notesGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 4rem;"><p>Failed to load notes. Please ensure the backend server is running!</p></div>';
            }
        }

        function filterNotes() {
            loadNotes();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('subjectFilter').value = '';
            document.getElementById('sortFilter').value = 'latest';
            loadNotes();
        }

        // Add listeners for instant filtering
        document.getElementById('subjectFilter').addEventListener('change', filterNotes);
        document.getElementById('sortFilter').addEventListener('change', filterNotes);
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') filterNotes();
        });

        loadNotes();
    </script>
</body>

</html>