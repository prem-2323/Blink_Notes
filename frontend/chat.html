<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - BlinkNotes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body style="overflow: hidden;">
    <div class="mesh-bg"></div>
    <div class="bg-accent-blob"></div>

    <!-- NAVBAR -->
    <nav>
        <div class="brand">
            <a href="index.html"><i class="fas fa-book-open"></i> <span>BlinkNotes</span></a>
        </div>
        <ul class="nav-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="browse.html">Browse</a></li>
            <li><a href="upload.html">Upload</a></li>
            <li><a href="chat.html" class="active">AI Assistant</a></li>
            <li><a href="login.html" class="btn btn-accent btn-sm">Sign In</a></li>
        </ul>
    </nav>

    <main class="container">
        <div class="chat-container">
            <!-- CHAT HEADER -->
            <div
                style="padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 1rem; background: var(--bg-glass);">
                <div class="bot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h2 style="font-size: 1.1rem; margin-bottom: 0.1rem;">Blink Bot</h2>
                    <div
                        style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: var(--success); font-weight: 600;">
                        <span style="width: 8px; height: 8px; background: var(--success); border-radius: 50%;"></span>
                        Online & Thinking
                    </div>
                </div>
                <div style="margin-left: auto; display: flex; gap: 0.5rem;">
                    <button class="btn btn-outline btn-sm" onclick="clearChat()"><i class="fas fa-trash"></i></button>
                    <button class="btn btn-outline btn-sm"><i class="fas fa-ellipsis-v"></i></button>
                </div>
            </div>

            <!-- MESSAGES AREA -->
            <div id="chatMessages" class="chat-messages">
                <div class="message bot">
                    Hello! I'm your academic assistant. You can ask me to summarize notes, explain topics, or find study
                    materials. How can I help you today?
                </div>
            </div>

            <!-- TYPING INDICATOR (HIDDEN) -->
            <div id="typingIndicator" style="padding: 0 2rem 1rem; display: none;">
                <div style="display: flex; gap: 0.4rem; color: var(--text-muted); font-size: 0.8rem;">
                    <i class="fas fa-circle fa-beat" style="font-size: 0.4rem;"></i>
                    <i class="fas fa-circle fa-beat" style="font-size: 0.4rem; animation-delay: 0.2s;"></i>
                    <i class="fas fa-circle fa-beat" style="font-size: 0.4rem; animation-delay: 0.4s;"></i>
                    Bot is thinking...
                </div>
            </div>

            <!-- INPUT AREA -->
            <div class="chat-input-area">
                <div style="flex: 1; position: relative;">
                    <input type="text" id="chatInput" class="form-control"
                        placeholder="Type your academic question here..." style="padding-right: 3rem;">
                    <i class="fas fa-paperclip"
                        style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); cursor: pointer;"></i>
                </div>
                <button class="btn btn-primary" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <script src="config.js"></script>
    <script>
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatMessages = document.getElementById('chatMessages');
        const typingIndicator = document.getElementById('typingIndicator');

        function appendMessage(text, role) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${role}`;
            msgDiv.textContent = text;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            chatInput.value = '';

            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch(`${window.env.API_URL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await response.json();

                typingIndicator.style.display = 'none';
                if (data.reply) {
                    appendMessage(data.reply, 'bot');
                } else {
                    appendMessage("I'm sorry, I couldn't process that. Try again?", 'bot');
                }
            } catch (error) {
                typingIndicator.style.display = 'none';
                appendMessage("Connection error. Is the backend running?", 'bot');
            }
        }

        sendBtn.onclick = sendMessage;
        chatInput.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };

        function clearChat() {
            chatMessages.innerHTML = '';
            appendMessage("Chat cleared. How can I help you now?", 'bot');
        }
    </script>
</body>

</html>