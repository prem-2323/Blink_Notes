<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Notes - BlinkNotes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="mesh-bg"></div>
    <div class="bg-accent-blob"></div>

    <!-- NAVBAR -->
    <nav>
        <div class="brand">
            <a href="index.html"><i class="fas fa-book-open"></i> <span>BlinkNotes</span></a>
        </div>
        <ul class="nav-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="browse.html">Browse</a></li>
            <li><a href="upload.html" class="active">Upload</a></li>
            <li><a href="chat.html">AI Assistant</a></li>
            <li><a href="login.html" class="btn btn-accent btn-sm">Sign In</a></li>
        </ul>
    </nav>

    <main class="container" style="padding: 4rem 0;">
        <div class="grid grid-2" style="grid-template-columns: 1.2fr 0.8fr; align-items: start; gap: 3rem;">
            <!-- UPLOAD FORM -->
            <div class="animate-fade-in"
                style="background: var(--bg-glass); padding: 3rem; border-radius: var(--radius-xl); border: 1px solid var(--border); box-shadow: var(--shadow-xl);">
                <h1 style="margin-bottom: 0.5rem; font-size: 2.5rem;">Share Your <span
                        style="color: var(--accent);">Knowledge</span></h1>
                <p style="color: var(--text-muted); margin-bottom: 2.5rem;">Help thousands of students by sharing your
                    study materials.</p>

                <form id="uploadForm">
                    <div class="form-group">
                        <label class="form-label">Note Title</label>
                        <input type="text" id="title" class="form-control" placeholder="e.g. Organic Chemistry Basics"
                            required>
                    </div>

                    <div class="grid grid-2" style="gap: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <select id="subject" class="form-control" required>
                                <option value="">Select Subject</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="physics">Physics</option>
                                <option value="chemistry">Chemistry</option>
                                <option value="biology">Biology</option>
                                <option value="computerscience">Computer Science</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <input type="number" id="semester" class="form-control" placeholder="1-8" min="1" max="8"
                                required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="description" class="form-control" rows="4"
                            placeholder="Briefly describe what's inside these notes..."></textarea>
                    </div>

                    <div class="form-group" style="margin-bottom: 2.5rem;">
                        <label class="form-label">Files (PDF or images)</label>
                        <div id="dropZone"
                            style="border: 2px dashed var(--border); padding: 3rem; border-radius: var(--radius-lg); text-align: center; cursor: pointer; transition: var(--transition); background: rgba(99, 102, 241, 0.02);">
                            <i class="fas fa-cloud-arrow-up"
                                style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                            <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">Click or drag file to upload</h3>
                            <p style="color: var(--text-muted); font-size: 0.875rem;">Support for PDF, DOCX, and PNG/JPG
                                (Max 20MB)</p>
                            <input type="file" id="fileInput" style="display: none;" accept=".pdf,.doc,.docx,image/*">
                        </div>
                        <div id="fileInfo" style="margin-top: 1rem; display: none;">
                            <div
                                style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--border); border-radius: var(--radius-md);">
                                <i class="fas fa-file-pdf" style="font-size: 1.5rem; color: var(--danger);"></i>
                                <div style="flex: 1;">
                                    <div id="fileName" style="font-weight: 600; font-size: 0.9rem;">filename.pdf</div>
                                    <div id="fileSize" style="font-size: 0.8rem; color: var(--text-muted);">1.2 MB</div>
                                </div>
                                <i class="fas fa-times" style="cursor: pointer;" onclick="resetFile()"></i>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                        Publish Notes <i class="fas fa-paper-plane" style="margin-left: 0.5rem;"></i>
                    </button>
                </form>
            </div>

            <!-- SIDEBAR INFO -->
            <div style="display: flex; flex-direction: column; gap: 2rem;">
                <div class="feature-card animate-scale-in" style="padding: 2rem; animation-delay: 0.2s;">
                    <h3 style="margin-bottom: 1rem;"><i class="fas fa-shield-check"
                            style="color: var(--success); margin-right: 0.5rem;"></i> Quality Guidelines</h3>
                    <ul style="list-style: none; color: var(--text-muted); font-size: 0.95rem;">
                        <li style="margin-bottom: 0.75rem;"><i class="fas fa-check"
                                style="color: var(--success); margin-right: 0.5rem;"></i> Ensure the handwriting is
                            legible.</li>
                        <li style="margin-bottom: 0.75rem;"><i class="fas fa-check"
                                style="color: var(--success); margin-right: 0.5rem;"></i> Include a clear title and
                            description.</li>
                        <li style="margin-bottom: 0.75rem;"><i class="fas fa-check"
                                style="color: var(--success); margin-right: 0.5rem;"></i> Use standard PDF format for
                            best quality.</li>
                        <li><i class="fas fa-check" style="color: var(--success); margin-right: 0.5rem;"></i> Respect
                            copyright and original authors.</li>
                    </ul>
                </div>

                <div class="feature-card"
                    style="padding: 2rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white;">
                    <h3 style="margin-bottom: 1rem; color: white;"><i class="fas fa-coins"
                            style="margin-right: 0.5rem;"></i> Why Upload?</h3>
                    <p style="font-size: 0.95rem; opacity: 0.9; margin-bottom: 1.5rem;">Every upload earns you
                        "BlinkPoints" which can be used to unlock premium AI features and exclusive badges.</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 700;">+50 Points/Upload</span>
                        <i class="fas fa-bolt" style="font-size: 1.5rem;"></i>
                    </div>
                </div>

                <div style="text-align: center; padding: 1rem;">
                    <p style="color: var(--text-muted); font-size: 0.85rem;">Need help? <a href="#"
                            style="color: var(--primary); font-weight: 600;">Contact Support</a></p>
                </div>
            </div>
        </div>
    </main>

    <script src="config.js"></script>
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');

        dropZone.onclick = () => fileInput.click();

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                showFileInfo(file);
            }
        };

        function showFileInfo(file) {
            fileName.textContent = file.name;
            fileSize.textContent = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
            fileInfo.style.display = 'block';
            dropZone.style.display = 'none';
        }

        function resetFile() {
            fileInput.value = '';
            fileInfo.style.display = 'none';
            dropZone.style.display = 'block';
        }

        document.getElementById('uploadForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file first');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('subjectTitle', document.getElementById('title').value);
            formData.append('subjectCode', document.getElementById('subject').value);
            formData.append('semester', document.getElementById('semester').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('userID', 'User_' + Math.floor(Math.random() * 1000)); // Dynamic user placeholder

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';

            try {
                const response = await fetch(`${window.env.API_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    alert('✅ Notes uploaded successfully!');
                    window.location.href = 'browse.html';
                } else {
                    alert('❌ Upload failed: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('❌ Connection error. Is the backend server running?');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Publish Notes <i class="fas fa-paper-plane" style="margin-left: 0.5rem;"></i>';
            }
        };
    </script>
</body>

</html>